<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>í†µê³„</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans KR',sans-serif;background:#0a0e17;color:#e0e6f0;min-height:100vh;padding:20px}
        .container{max-width:1200px;margin:0 auto}
        h1{font-size:22px;font-weight:900;text-align:center;margin-bottom:6px}
        .sub{text-align:center;margin-bottom:24px}
        .sub a{color:#3b82f6;text-decoration:none;font-size:13px}

        /* ì¹´ìš´í„° */
        .counters{display:flex;justify-content:center;gap:20px;margin-bottom:28px;flex-wrap:wrap}
        .counter{background:#111827;border:1px solid #1e2a42;border-radius:12px;padding:20px 28px;text-align:center;min-width:120px}
        .counter .num{font-size:28px;font-weight:900;color:#fff}
        .counter .label{font-size:11px;color:#5a6a8a;margin-top:4px}

        /* ì„¹ì…˜ */
        .section{margin-bottom:28px}
        .section-title{font-size:15px;font-weight:800;margin-bottom:12px;display:flex;align-items:center;gap:8px}

        /* í…Œì´ë¸” */
        table{width:100%;border-collapse:collapse;background:#111827;border-radius:12px;overflow:hidden}
        th{background:#0d1220;padding:10px 14px;text-align:left;font-size:11px;color:#5a6a8a;font-weight:600}
        td{padding:10px 14px;border-top:1px solid #151d30;font-size:12px;color:#8899bb}
        tr:hover td{background:rgba(37,99,235,.03)}
        .n-highlight{color:#fff;font-weight:700}
        .n-blue{color:#3b82f6}
        .n-green{color:#22c55e}
        .n-orange{color:#fb923c}
        .n-purple{color:#c084fc}
        .n-red{color:#f87171}

        /* ë°” ì°¨íŠ¸ */
        .bar-wrap{display:flex;align-items:center;gap:8px}
        .bar{height:16px;border-radius:4px;min-width:2px;transition:width .3s}
        .bar.stock{background:rgba(34,197,94,.3)}
        .bar.industry{background:rgba(251,146,60,.3)}
        .bar.strategy{background:rgba(168,85,247,.3)}

        .badge{font-size:10px;padding:2px 6px;border-radius:3px;font-weight:700}
        .badge.up{background:rgba(34,197,94,.12);color:#22c55e}
        .badge.down{background:rgba(239,68,68,.12);color:#ef4444}
        .badge.flat{background:rgba(234,179,8,.12);color:#eab308}

        .link-date{color:#3b82f6;text-decoration:none}
        .link-date:hover{text-decoration:underline}

        @media(max-width:768px){
            .counters{gap:10px}
            .counter{min-width:80px;padding:14px 16px}
            .counter .num{font-size:22px}
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ“ˆ ë¦¬í¬íŠ¸ í†µê³„</h1>
    <div class="sub"><a href="/dashboard">â† ëŒ€ì‹œë³´ë“œ</a> Â· <a href="/compare">ì¦ê¶Œì‚¬ ë¹„êµ</a></div>

    <!-- ì¹´ìš´í„° -->
    <div class="counters">
        <div class="counter"><div class="num">{{ total }}</div><div class="label">ì „ì²´ ë¦¬í¬íŠ¸</div></div>
        <div class="counter"><div class="num">{{ total_dates }}</div><div class="label">ë¶„ì„ ì¼ìˆ˜</div></div>
        <div class="counter"><div class="num">{{ by_broker|length }}</div><div class="label">ì¦ê¶Œì‚¬</div></div>
        <div class="counter"><div class="num">{{ rating_changes|length }}</div><div class="label">ì˜ê²¬ë³€ê²½</div></div>
    </div>

    <!-- ì¼ë³„ í˜„í™© -->
    <div class="section">
        <div class="section-title">ğŸ“… ì¼ë³„ í˜„í™©</div>
        <table>
            <tr><th>ë‚ ì§œ</th><th>ì „ì²´</th><th>ì¢…ëª©</th><th>ì‚°ì—…</th><th>ì „ëµ</th><th>ì˜ê²¬ë³€ê²½</th><th>ë¶„í¬</th></tr>
            {% for d in daily %}
            <tr>
                <td><a href="/dashboard?date={{ d.report_date }}" class="link-date">{{ d.report_date }}</a></td>
                <td class="n-highlight">{{ d.cnt }}</td>
                <td class="n-green">{{ d.stocks }}</td>
                <td class="n-orange">{{ d.industries }}</td>
                <td class="n-purple">{{ d.strategies }}</td>
                <td>{% if d.upgrades %}<span class="n-red">{{ d.upgrades }}</span>{% else %}-{% endif %}</td>
                <td>
                    <div class="bar-wrap">
                        {% if d.stocks %}<div class="bar stock" style="width:{{ d.stocks * 20 }}px" title="ì¢…ëª© {{ d.stocks }}"></div>{% endif %}
                        {% if d.industries %}<div class="bar industry" style="width:{{ d.industries * 20 }}px" title="ì‚°ì—… {{ d.industries }}"></div>{% endif %}
                        {% if d.strategies %}<div class="bar strategy" style="width:{{ d.strategies * 20 }}px" title="ì „ëµ {{ d.strategies }}"></div>{% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- ì¦ê¶Œì‚¬ë³„ -->
    <div class="section">
        <div class="section-title">ğŸ¦ ì¦ê¶Œì‚¬ë³„</div>
        <table>
            <tr><th>ì¦ê¶Œì‚¬</th><th>ë¦¬í¬íŠ¸ ìˆ˜</th><th></th></tr>
            {% for b in by_broker %}
            <tr>
                <td class="n-highlight">{{ b.brokerage }}</td>
                <td class="n-blue">{{ b.cnt }}</td>
                <td><div class="bar stock" style="width:{{ b.cnt * 15 }}px"></div></td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- ì¢…ëª©ë³„ -->
    <div class="section">
        <div class="section-title">ğŸ“Š ë§ì´ ì»¤ë²„ëœ ì¢…ëª©</div>
        <table>
            <tr><th>ì¢…ëª©</th><th>ë¦¬í¬íŠ¸ ìˆ˜</th><th>ì¦ê¶Œì‚¬ ìˆ˜</th><th></th></tr>
            {% for s in by_stock %}
            <tr>
                <td><a href="/compare?stock={{ s.stock_name }}" class="link-date">{{ s.stock_name }}</a></td>
                <td class="n-highlight">{{ s.cnt }}</td>
                <td class="n-blue">{{ s.brokers }}ì‚¬</td>
                <td><div class="bar stock" style="width:{{ s.cnt * 15 }}px"></div></td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- ì˜ê²¬ë³€ê²½ íˆìŠ¤í† ë¦¬ -->
    {% if rating_changes %}
    <div class="section">
        <div class="section-title">ğŸ”„ íˆ¬ìì˜ê²¬ ë³€ê²½ íˆìŠ¤í† ë¦¬</div>
        <table>
            <tr><th>ë‚ ì§œ</th><th>ì¢…ëª©</th><th>ì¦ê¶Œì‚¬</th><th>ë³€ê²½</th><th>ëª©í‘œê°€</th></tr>
            {% for r in rating_changes %}
            <tr>
                <td><a href="/dashboard?date={{ r.report_date }}" class="link-date">{{ r.report_date }}</a></td>
                <td class="n-highlight">{{ r.stock_name }}</td>
                <td class="n-blue">{{ r.brokerage }}</td>
                <td>
                    <span style="color:#6b7a9a;text-decoration:line-through">{{ r.prev_rating }}</span>
                    <span style="color:#f59e0b">â†’</span>
                    <span class="{% if r.rating in ['Buy','Overweight','Outperform'] %}n-green{% elif r.rating in ['Sell','Underweight'] %}n-red{% else %}n-orange{% endif %}">{{ r.rating }}</span>
                </td>
                <td>
                    {% if r.prev_target_price %}
                    {{ r.prev_target_price }} â†’ <b style="color:#fff">{{ r.target_price }}</b>
                    {% else %}
                    {{ r.target_price or '-' }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}
</div>
</body>
</html>
