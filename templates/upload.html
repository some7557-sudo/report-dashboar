<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>PDF ì—…ë¡œë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans KR',sans-serif;background:#0a0e17;color:#e0e6f0;min-height:100vh;
            display:flex;flex-direction:column;align-items:center;padding:40px 20px}
        h1{font-size:22px;font-weight:900;margin-bottom:8px}
        .sub{color:#4a5a7a;font-size:13px;margin-bottom:24px}
        .sub a{color:#3b82f6;text-decoration:none}
        .drop{width:100%;max-width:600px;border:2px dashed #1e2a42;border-radius:16px;padding:60px 20px;
            text-align:center;cursor:pointer;transition:all .2s;background:#0d1220}
        .drop:hover,.drop.over{border-color:#2563eb;background:#0f1528}
        .drop .icon{font-size:48px;margin-bottom:12px}
        .drop p{color:#5a6a8a;font-size:14px}
        .drop p b{color:#3b82f6}
        input[type=file]{display:none}
        .results{width:100%;max-width:600px;margin-top:20px}
        .r-item{background:#111827;border:1px solid #1e2a42;border-radius:10px;padding:14px 16px;margin-bottom:8px;
            display:flex;align-items:center;gap:12px}
        .r-icon{font-size:20px;flex-shrink:0}
        .r-info{flex:1;min-width:0}
        .r-file{font-size:13px;font-weight:700;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .r-detail{font-size:11px;color:#4a5a7a;margin-top:2px}
        .r-detail b{color:#22c55e}
        .r-status{font-size:11px;padding:3px 8px;border-radius:4px;font-weight:700;flex-shrink:0}
        .r-status.ok{background:rgba(34,197,94,.12);color:#22c55e}
        .r-status.err{background:rgba(239,68,68,.12);color:#ef4444}
        .r-status.loading{background:rgba(59,130,246,.12);color:#3b82f6}
        .progress{width:100%;max-width:600px;margin-top:12px;text-align:center;color:#3b82f6;font-size:13px;display:none}
        .back{margin-top:20px;color:#3b82f6;text-decoration:none;font-size:13px}
    </style>
</head>
<body>
    <h1>ğŸ“¤ PDF ë¦¬í¬íŠ¸ ì—…ë¡œë“œ</h1>
    <div class="sub"><a href="/dashboard">â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a></div>

    <div class="drop" id="drop" onclick="document.getElementById('fileInput').click()">
        <div class="icon">ğŸ“„</div>
        <p>PDF íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ <b>í´ë¦­</b>í•´ì„œ ì—…ë¡œë“œ</p>
        <p style="margin-top:6px;font-size:12px;color:#3a4a6a">ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ì—…ë¡œë“œ ê°€ëŠ¥</p>
    </div>
    <input type="file" id="fileInput" accept=".pdf" multiple>

    <div class="progress" id="progress">âš¡ ë¶„ì„ ì¤‘... <span id="progCount"></span></div>
    <div class="results" id="results"></div>
    <a href="/dashboard" class="back">â† ëŒ€ì‹œë³´ë“œ</a>

<script>
const drop=document.getElementById('drop'),fi=document.getElementById('fileInput'),
      res=document.getElementById('results'),prog=document.getElementById('progress'),
      progC=document.getElementById('progCount');

['dragenter','dragover'].forEach(e=>drop.addEventListener(e,ev=>{ev.preventDefault();drop.classList.add('over')}));
['dragleave','drop'].forEach(e=>drop.addEventListener(e,ev=>{ev.preventDefault();drop.classList.remove('over')}));
drop.addEventListener('drop',e=>{if(e.dataTransfer.files.length)uploadFiles(e.dataTransfer.files)});
fi.addEventListener('change',()=>{if(fi.files.length)uploadFiles(fi.files)});

async function uploadFiles(files){
    const pdfs=[...files].filter(f=>f.name.toLowerCase().endsWith('.pdf'));
    if(!pdfs.length){alert('PDF íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤');return}
    res.innerHTML='';
    prog.style.display='block';
    let done=0;
    for(const f of pdfs){
        progC.textContent=`(${done+1}/${pdfs.length}) ${f.name}`;
        const id='r_'+Math.random().toString(36).slice(2);
        res.insertAdjacentHTML('beforeend',
            `<div class="r-item" id="${id}"><span class="r-icon">ğŸ“„</span><div class="r-info"><div class="r-file">${f.name}</div><div class="r-detail">ë¶„ì„ ì¤‘...</div></div><span class="r-status loading">ì²˜ë¦¬ì¤‘</span></div>`);
        try{
            const fd=new FormData();fd.append('pdfs',f);
            const resp=await fetch('/upload',{method:'POST',body:fd,headers:{Accept:'application/json'}});
            const data=await resp.json();
            const item=data[0]||{};
            const el=document.getElementById(id);
            if(item.status==='success'){
                el.querySelector('.r-detail').innerHTML=`<b>${item.stock||''}</b> Â· ${item.brokerage||''}`;
                el.querySelector('.r-status').className='r-status ok';
                el.querySelector('.r-status').textContent='ì™„ë£Œ';
            }else{
                el.querySelector('.r-detail').textContent=item.msg||'ì˜¤ë¥˜';
                el.querySelector('.r-status').className='r-status err';
                el.querySelector('.r-status').textContent='ì‹¤íŒ¨';
            }
        }catch(e){
            const el=document.getElementById(id);
            el.querySelector('.r-detail').textContent=e.message;
            el.querySelector('.r-status').className='r-status err';
            el.querySelector('.r-status').textContent='ì‹¤íŒ¨';
        }
        done++;
    }
    prog.style.display='none';
    progC.textContent='';
}
</script>
</body>
</html>
